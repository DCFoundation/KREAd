{"ast":null,"code":"// @ts-check\n// Lifted mostly from `@endo/eventual-send/src/E.js`.\nimport './types.js';\n/**\n * Default implementation of Trap for near objects.\n *\n * @type {TrapImpl}\n */\n\nexport const nearTrapImpl = harden({\n  applyFunction(target, args) {\n    return target(...args);\n  },\n\n  applyMethod(target, prop, args) {\n    return target[prop](...args);\n  },\n\n  get(target, prop) {\n    return target[prop];\n  }\n\n});\n/** @type {ProxyHandler<any>} */\n\nconst baseFreezableProxyHandler = {\n  set(_target, _prop, _value) {\n    return false;\n  },\n\n  isExtensible(_target) {\n    return false;\n  },\n\n  setPrototypeOf(_target, _value) {\n    return false;\n  },\n\n  deleteProperty(_target, _prop) {\n    return false;\n  }\n\n};\n/**\n * A Proxy handler for Trap(x)\n *\n * @param {*} x Any value passed to Trap(x)\n * @param {TrapImpl} trapImpl\n * @returns {ProxyHandler}\n */\n\nconst TrapProxyHandler = (x, trapImpl) => {\n  return harden({ ...baseFreezableProxyHandler,\n\n    get(_target, p, _receiver) {\n      return function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        return trapImpl.applyMethod(x, p, args);\n      };\n    },\n\n    apply(_target, _thisArg) {\n      let argArray = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      return trapImpl.applyFunction(x, argArray);\n    },\n\n    has(_target, _p) {\n      // TODO: has property is not yet transferrable over captp.\n      return true;\n    }\n\n  });\n};\n/**\n * @param {TrapImpl} trapImpl\n * @returns {Trap}\n */\n\n\nexport const makeTrap = trapImpl => {\n  const Trap = x => {\n    const handler = TrapProxyHandler(x, trapImpl);\n    return harden(new Proxy(() => {}, handler));\n  };\n\n  const makeTrapGetterProxy = x => {\n    const handler = harden({ ...baseFreezableProxyHandler,\n\n      has(_target, _prop) {\n        // TODO: has property is not yet transferrable over captp.\n        return true;\n      },\n\n      get(_target, prop) {\n        return trapImpl.get(x, prop);\n      }\n\n    });\n    return new Proxy(Object.create(null), handler);\n  };\n\n  Trap.get = makeTrapGetterProxy;\n  return harden(Trap);\n};","map":{"version":3,"names":["nearTrapImpl","harden","applyFunction","target","args","applyMethod","prop","get","baseFreezableProxyHandler","set","_target","_prop","_value","isExtensible","setPrototypeOf","deleteProperty","TrapProxyHandler","x","trapImpl","p","_receiver","apply","_thisArg","argArray","has","_p","makeTrap","Trap","handler","Proxy","makeTrapGetterProxy","Object","create"],"sources":["/Users/carlostrigoseguin/Documents/KRYHA/agoric/character-builder-repo/ui/node_modules/@endo/captp/src/trap.js"],"sourcesContent":["// @ts-check\n// Lifted mostly from `@endo/eventual-send/src/E.js`.\n\nimport './types.js';\n\n/**\n * Default implementation of Trap for near objects.\n *\n * @type {TrapImpl}\n */\nexport const nearTrapImpl = harden({\n  applyFunction(target, args) {\n    return target(...args);\n  },\n  applyMethod(target, prop, args) {\n    return target[prop](...args);\n  },\n  get(target, prop) {\n    return target[prop];\n  },\n});\n\n/** @type {ProxyHandler<any>} */\nconst baseFreezableProxyHandler = {\n  set(_target, _prop, _value) {\n    return false;\n  },\n  isExtensible(_target) {\n    return false;\n  },\n  setPrototypeOf(_target, _value) {\n    return false;\n  },\n  deleteProperty(_target, _prop) {\n    return false;\n  },\n};\n\n/**\n * A Proxy handler for Trap(x)\n *\n * @param {*} x Any value passed to Trap(x)\n * @param {TrapImpl} trapImpl\n * @returns {ProxyHandler}\n */\nconst TrapProxyHandler = (x, trapImpl) => {\n  return harden({\n    ...baseFreezableProxyHandler,\n    get(_target, p, _receiver) {\n      return (...args) => trapImpl.applyMethod(x, p, args);\n    },\n    apply(_target, _thisArg, argArray = []) {\n      return trapImpl.applyFunction(x, argArray);\n    },\n    has(_target, _p) {\n      // TODO: has property is not yet transferrable over captp.\n      return true;\n    },\n  });\n};\n\n/**\n * @param {TrapImpl} trapImpl\n * @returns {Trap}\n */\nexport const makeTrap = trapImpl => {\n  const Trap = x => {\n    const handler = TrapProxyHandler(x, trapImpl);\n    return harden(new Proxy(() => {}, handler));\n  };\n\n  const makeTrapGetterProxy = x => {\n    const handler = harden({\n      ...baseFreezableProxyHandler,\n      has(_target, _prop) {\n        // TODO: has property is not yet transferrable over captp.\n        return true;\n      },\n      get(_target, prop) {\n        return trapImpl.get(x, prop);\n      },\n    });\n    return new Proxy(Object.create(null), handler);\n  };\n  Trap.get = makeTrapGetterProxy;\n\n  return harden(Trap);\n};\n"],"mappings":"AAAA;AACA;AAEA,OAAO,YAAP;AAEA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMA,YAAY,GAAGC,MAAM,CAAC;EACjCC,aAAa,CAACC,MAAD,EAASC,IAAT,EAAe;IAC1B,OAAOD,MAAM,CAAC,GAAGC,IAAJ,CAAb;EACD,CAHgC;;EAIjCC,WAAW,CAACF,MAAD,EAASG,IAAT,EAAeF,IAAf,EAAqB;IAC9B,OAAOD,MAAM,CAACG,IAAD,CAAN,CAAa,GAAGF,IAAhB,CAAP;EACD,CANgC;;EAOjCG,GAAG,CAACJ,MAAD,EAASG,IAAT,EAAe;IAChB,OAAOH,MAAM,CAACG,IAAD,CAAb;EACD;;AATgC,CAAD,CAA3B;AAYP;;AACA,MAAME,yBAAyB,GAAG;EAChCC,GAAG,CAACC,OAAD,EAAUC,KAAV,EAAiBC,MAAjB,EAAyB;IAC1B,OAAO,KAAP;EACD,CAH+B;;EAIhCC,YAAY,CAACH,OAAD,EAAU;IACpB,OAAO,KAAP;EACD,CAN+B;;EAOhCI,cAAc,CAACJ,OAAD,EAAUE,MAAV,EAAkB;IAC9B,OAAO,KAAP;EACD,CAT+B;;EAUhCG,cAAc,CAACL,OAAD,EAAUC,KAAV,EAAiB;IAC7B,OAAO,KAAP;EACD;;AAZ+B,CAAlC;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAMK,gBAAgB,GAAG,CAACC,CAAD,EAAIC,QAAJ,KAAiB;EACxC,OAAOjB,MAAM,CAAC,EACZ,GAAGO,yBADS;;IAEZD,GAAG,CAACG,OAAD,EAAUS,CAAV,EAAaC,SAAb,EAAwB;MACzB,OAAO;QAAA,kCAAIhB,IAAJ;UAAIA,IAAJ;QAAA;;QAAA,OAAac,QAAQ,CAACb,WAAT,CAAqBY,CAArB,EAAwBE,CAAxB,EAA2Bf,IAA3B,CAAb;MAAA,CAAP;IACD,CAJW;;IAKZiB,KAAK,CAACX,OAAD,EAAUY,QAAV,EAAmC;MAAA,IAAfC,QAAe,uEAAJ,EAAI;MACtC,OAAOL,QAAQ,CAAChB,aAAT,CAAuBe,CAAvB,EAA0BM,QAA1B,CAAP;IACD,CAPW;;IAQZC,GAAG,CAACd,OAAD,EAAUe,EAAV,EAAc;MACf;MACA,OAAO,IAAP;IACD;;EAXW,CAAD,CAAb;AAaD,CAdD;AAgBA;AACA;AACA;AACA;;;AACA,OAAO,MAAMC,QAAQ,GAAGR,QAAQ,IAAI;EAClC,MAAMS,IAAI,GAAGV,CAAC,IAAI;IAChB,MAAMW,OAAO,GAAGZ,gBAAgB,CAACC,CAAD,EAAIC,QAAJ,CAAhC;IACA,OAAOjB,MAAM,CAAC,IAAI4B,KAAJ,CAAU,MAAM,CAAE,CAAlB,EAAoBD,OAApB,CAAD,CAAb;EACD,CAHD;;EAKA,MAAME,mBAAmB,GAAGb,CAAC,IAAI;IAC/B,MAAMW,OAAO,GAAG3B,MAAM,CAAC,EACrB,GAAGO,yBADkB;;MAErBgB,GAAG,CAACd,OAAD,EAAUC,KAAV,EAAiB;QAClB;QACA,OAAO,IAAP;MACD,CALoB;;MAMrBJ,GAAG,CAACG,OAAD,EAAUJ,IAAV,EAAgB;QACjB,OAAOY,QAAQ,CAACX,GAAT,CAAaU,CAAb,EAAgBX,IAAhB,CAAP;MACD;;IARoB,CAAD,CAAtB;IAUA,OAAO,IAAIuB,KAAJ,CAAUE,MAAM,CAACC,MAAP,CAAc,IAAd,CAAV,EAA+BJ,OAA/B,CAAP;EACD,CAZD;;EAaAD,IAAI,CAACpB,GAAL,GAAWuB,mBAAX;EAEA,OAAO7B,MAAM,CAAC0B,IAAD,CAAb;AACD,CAtBM"},"metadata":{},"sourceType":"module"}