{"ast":null,"code":"// @ts-check\nimport { trackTurns } from './track-turns.js'; /// <reference path=\"index.d.ts\" />\n\n/** @type {ProxyHandler<any>} */\n\nconst baseFreezableProxyHandler = {\n  set(_target, _prop, _value) {\n    return false;\n  },\n\n  isExtensible(_target) {\n    return false;\n  },\n\n  setPrototypeOf(_target, _value) {\n    return false;\n  },\n\n  deleteProperty(_target, _prop) {\n    return false;\n  }\n\n};\n/**\n * A Proxy handler for E(x).\n *\n * @param {*} x Any value passed to E(x)\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {ProxyHandler} the Proxy handler\n */\n\nfunction EProxyHandler(x, HandledPromise) {\n  return harden({ ...baseFreezableProxyHandler,\n\n    get(_target, p, _receiver) {\n      return harden(function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        return HandledPromise.applyMethod(x, p, args);\n      });\n    },\n\n    apply(_target, _thisArg) {\n      let argArray = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      return HandledPromise.applyFunction(x, argArray);\n    },\n\n    has(_target, _p) {\n      // We just pretend everything exists.\n      return true;\n    }\n\n  });\n}\n/**\n * A Proxy handler for E.sendOnly(x)\n * It is a variant on the E(x) Proxy handler.\n *\n * @param {*} x Any value passed to E.sendOnly(x)\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {ProxyHandler} the Proxy handler\n */\n\n\nfunction EsendOnlyProxyHandler(x, HandledPromise) {\n  return harden({ ...baseFreezableProxyHandler,\n\n    get(_target, p, _receiver) {\n      return function () {\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n\n        HandledPromise.applyMethodSendOnly(x, p, args);\n        return undefined;\n      };\n    },\n\n    apply(_target, _thisArg) {\n      let argsArray = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      HandledPromise.applyFunctionSendOnly(x, argsArray);\n      return undefined;\n    },\n\n    has(_target, _p) {\n      // We just pretend that everything exists.\n      return true;\n    }\n\n  });\n}\n/**\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {import('./index').EProxy}\n */\n\n\nexport default function makeE(HandledPromise) {\n  function E(x) {\n    const handler = EProxyHandler(x, HandledPromise);\n    return harden(new Proxy(() => {}, handler));\n  }\n\n  const makeEGetterProxy = x => new Proxy(Object.create(null), { ...baseFreezableProxyHandler,\n\n    has(_target, _prop) {\n      return true;\n    },\n\n    get(_target, prop) {\n      return HandledPromise.get(x, prop);\n    }\n\n  });\n\n  E.get = makeEGetterProxy;\n  E.resolve = HandledPromise.resolve;\n\n  E.sendOnly = x => {\n    const handler = EsendOnlyProxyHandler(x, HandledPromise);\n    return harden(new Proxy(() => {}, handler));\n  };\n\n  E.when = (x, onfulfilled, onrejected) => {\n    const [onsuccess, onfailure] = trackTurns([onfulfilled, onrejected]);\n    return HandledPromise.resolve(x).then(onsuccess, onfailure);\n  };\n\n  return harden(E);\n}","map":{"version":3,"names":["trackTurns","baseFreezableProxyHandler","set","_target","_prop","_value","isExtensible","setPrototypeOf","deleteProperty","EProxyHandler","x","HandledPromise","harden","get","p","_receiver","args","applyMethod","apply","_thisArg","argArray","applyFunction","has","_p","EsendOnlyProxyHandler","applyMethodSendOnly","undefined","argsArray","applyFunctionSendOnly","makeE","E","handler","Proxy","makeEGetterProxy","Object","create","prop","resolve","sendOnly","when","onfulfilled","onrejected","onsuccess","onfailure","then"],"sources":["/Users/carlostrigoseguin/Documents/KRYHA/agoric/character-builder-repo/ui/node_modules/@endo/eventual-send/src/E.js"],"sourcesContent":["// @ts-check\nimport { trackTurns } from './track-turns.js';\n\n/// <reference path=\"index.d.ts\" />\n\n/** @type {ProxyHandler<any>} */\nconst baseFreezableProxyHandler = {\n  set(_target, _prop, _value) {\n    return false;\n  },\n  isExtensible(_target) {\n    return false;\n  },\n  setPrototypeOf(_target, _value) {\n    return false;\n  },\n  deleteProperty(_target, _prop) {\n    return false;\n  },\n};\n\n/**\n * A Proxy handler for E(x).\n *\n * @param {*} x Any value passed to E(x)\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {ProxyHandler} the Proxy handler\n */\nfunction EProxyHandler(x, HandledPromise) {\n  return harden({\n    ...baseFreezableProxyHandler,\n    get(_target, p, _receiver) {\n      return harden((...args) => HandledPromise.applyMethod(x, p, args));\n    },\n    apply(_target, _thisArg, argArray = []) {\n      return HandledPromise.applyFunction(x, argArray);\n    },\n    has(_target, _p) {\n      // We just pretend everything exists.\n      return true;\n    },\n  });\n}\n\n/**\n * A Proxy handler for E.sendOnly(x)\n * It is a variant on the E(x) Proxy handler.\n *\n * @param {*} x Any value passed to E.sendOnly(x)\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {ProxyHandler} the Proxy handler\n */\nfunction EsendOnlyProxyHandler(x, HandledPromise) {\n  return harden({\n    ...baseFreezableProxyHandler,\n    get(_target, p, _receiver) {\n      return (...args) => {\n        HandledPromise.applyMethodSendOnly(x, p, args);\n        return undefined;\n      };\n    },\n    apply(_target, _thisArg, argsArray = []) {\n      HandledPromise.applyFunctionSendOnly(x, argsArray);\n      return undefined;\n    },\n    has(_target, _p) {\n      // We just pretend that everything exists.\n      return true;\n    },\n  });\n}\n\n/**\n * @param {import('./index').HandledPromiseConstructor} HandledPromise\n * @returns {import('./index').EProxy}\n */\nexport default function makeE(HandledPromise) {\n  function E(x) {\n    const handler = EProxyHandler(x, HandledPromise);\n    return harden(new Proxy(() => {}, handler));\n  }\n\n  const makeEGetterProxy = x =>\n    new Proxy(Object.create(null), {\n      ...baseFreezableProxyHandler,\n      has(_target, _prop) {\n        return true;\n      },\n      get(_target, prop) {\n        return HandledPromise.get(x, prop);\n      },\n    });\n\n  E.get = makeEGetterProxy;\n  E.resolve = HandledPromise.resolve;\n  E.sendOnly = x => {\n    const handler = EsendOnlyProxyHandler(x, HandledPromise);\n    return harden(new Proxy(() => {}, handler));\n  };\n\n  E.when = (x, onfulfilled, onrejected) => {\n    const [onsuccess, onfailure] = trackTurns([onfulfilled, onrejected]);\n    return HandledPromise.resolve(x).then(onsuccess, onfailure);\n  };\n\n  return harden(E);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}